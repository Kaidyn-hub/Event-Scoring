<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard</title>
    <link rel="stylesheet" href="style/scoreboard.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<header class="top-buttons">
    <button onclick="window.location.href='home.html'" class="btn btn-outline-primary">‚Üê Go Back</button>
    <button class="btn btn-outline-secondary btn-sm" onclick="confirmLogout(event)">Logout</button>
</header>

<body>
    <div class="container text-center">
        <h2 id="eventTitle">Event Scoreboard</h2>
        <p>Gold - 5 | Silver - 3 | Bronze - 1</p>
        <div id="scoreboard-container"></div>

        <div class="button-container">
            <button class="btn btn-outline-success" onclick="updateAllScores()">Update</button>
            <button class="btn btn-outline-warning" onclick="resetScoreboard()">Reset</button>
            <button class="btn btn-outline-danger" onclick="window.location.href='delete_confirmation.html'">Delete All</button>
        </div>
    </div>

    <script>
        function loadScoreboard() {
            fetch("fetch_scores.php")
                .then(response => response.json())
                .then(data => {
                    let container = document.getElementById("scoreboard-container");
                    container.innerHTML = "";

                    for (const event in data) {
                        let eventTable = `
                            <h3 class="event-title">${event}</h3>
                            <table class="table table-bordered text-center">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Participant</th>
                                        <th>Gold</th>
                                        <th>Silver</th>
                                        <th>Bronze</th>
                                        <th>Total Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;

                        data[event].forEach((row, index) => {
                            let total = (parseInt(row.gold) * 5) + (parseInt(row.silver) * 3) + (parseInt(row.bronze) * 1);
                            eventTable += `
                                <tr data-id="${row.id}">
                                    <td>${total > 0 ? index + 1 : "-"}</td>
                                    <td>${row.participants}</td>
                                    <td><input type="number" class="gold" value="${row.gold}" min="0"></td>
                                    <td><input type="number" class="silver" value="${row.silver}" min="0"></td>
                                    <td><input type="number" class="bronze" value="${row.bronze}" min="0"></td>
                                    <td class="total">${total}</td>
                                </tr>
                            `;
                        });

                        eventTable += `
                                </tbody>
                            </table>
                        `;
                        container.innerHTML += eventTable;
                    }
                });
        }

        function updateAllScores() {
            document.querySelectorAll("tr[data-id]").forEach(row => {
                let id = row.dataset.id;
                let gold = row.querySelector(".gold").value;
                let silver = row.querySelector(".silver").value;
                let bronze = row.querySelector(".bronze").value;
                let totalCell = row.querySelector(".total");

                let newTotal = (parseInt(gold) * 5) + (parseInt(silver) * 3) + (parseInt(bronze) * 1);
                totalCell.textContent = newTotal;

                fetch("update_score.php", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `id=${id}&gold=${gold }&silver=${silver}&bronze=${bronze}`
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            loadScoreboard();
                        } else {
                            alert("Update failed: " + data.message);
                        }
                    });
            });
        }

        function resetScoreboard() {
            fetch("reset_scoreboard.php", { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    if (data.status === "success") {
                        loadScoreboard();
                    }
                });
        }

        function confirmLogout(event) {
            event.preventDefault();

            const userConfirmed = confirm("Are you sure you want to logout?");
            if (userConfirmed) {
                window.location.href = "logout.php";
            }
        }

        document.addEventListener("DOMContentLoaded", loadScoreboard);
    </script>
</body>

<footer>
    <p class="mb-2">&copy; 2025 Aijalon Sindo. All rights reserved.</p>
</footer>

</html>